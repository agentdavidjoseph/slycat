<!DOCTYPE html>

<!--
Copyright 2013, Sandia Corporation. Under the terms of Contract
DE-AC04-94AL85000 with Sandia Corporation, the U.S. Government retains certain
rights in this software.
-->

<html>
  <head>
{{> head}}
    <title>Open Models</title>
  </head>

  <body>
{{> header}}

    <div id="page-title">
      <div class="width-wrapper">
        <h2>Open Models</h2>
      </div>
    </div>

    <div id="content">
      <div class="width-wrapper">
        <p id="revision"></p>
        <table id="models">
        </table>
      </div>
    </div>

    <div id="footer">
      <div class="width-wrapper">
      </div>
    </div>

    <script type="text/javascript">
      $(document).ready(function()
      {
        function update(revision)
        {
          $.ajax(
          {
            dataType : "json",
            type : "GET",
            url : "{{server-root}}models/open" + (revision != undefined ? "?revision=" + revision : ""),
            success : function(results)
            {
              var revision = results[0];
              var models = results[1];

              $("#revision").text("Revision: " + revision);
              $("#models").empty().append("<tr><th>ID</th><th>State</th><th>Result</th><th>Created</th><th>Started</th><th>Finished</th><th>Progress</th><th>Message</th></tr>");

              $.each(models, function(index, model)
              {
                $("<tr>")
                  .append($("<td>").append($("<a>").text(model["_id"]).attr("href", model["uri"])))
                  .append($("<td>").text(model["state"]))
                  .append($("<td>").text(model["result"]))
                  .append($("<td>").text(model["created"]))
                  .append($("<td>").text(model["started"]))
                  .append($("<td>").text(model["finished"]))
                  .append($("<td>").text(model["progress"]))
                  .append($("<td>").text(model["message"]))
                  .appendTo($("#models"));
              });

              window.setTimeout(update.bind(this, revision), 10);
            },
            error : function(request, status, reason_phrase)
            {
              window.setTimeout(update.bind(this), 5000);
            }
          });
        }

        update();
      });
    </script>
  </body>
</html>
