<!DOCTYPE html>
<html>
  <head>
    <script src="js/curl.js"></script>
    <script src="js/slycat-curl-config.js"></script>
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/knockout-3.2.0.js"></script>
    <script src="js/knockout.mapping.js"></script>
    <style>
      .scrollbar-container
      {
        border: 1px solid black;
      }
      .scrollbar-bar
      {
        background: black;
      }
    </style>
    <title>Slycat Scrollbar Test</title>
  </head>
  <body>
    <div class="scrollbar-container" data-bind="style: {width: width() + 'px', height: height() + 'px'}" style="position: relative">
      <div class="scrollbar-bar" data-bind="event: {mousedown: bar.mousedown, mousemove: bar.mousemove, mouseup: bar.mouseup}, style: {width: bar.width() + 'px', height: bar.height() + 'px', top: range.value() + 'px'}" style="position: absolute">
      </div>
    </div>
    <p>Bar value: <span data-bind="text: domain.value"></span></p>
    <script>
      require(["knockout", "knockout-mapping"], function(ko, mapping)
      {
        var scrollbar = mapping.fromJS(
        {
          width: 30,
          height: 500,
          bar: { width: 30, height: 30, last_drag: null },
          domain: { min: 0, value: 50, max: 100 },
          range: { min: 0 },
        });
        scrollbar.range.max = ko.pureComputed(function()
        {
          return scrollbar.height() - scrollbar.bar.height();
        });
        scrollbar.range.value = ko.pureComputed(function()
        {
          return (scrollbar.domain.value() - scrollbar.domain.min()) / (scrollbar.domain.max() - scrollbar.domain.min()) * (scrollbar.range.max() - scrollbar.range.min() + scrollbar.range.min());
        });
        scrollbar.bar.mousedown = function(model, e)
        {
          scrollbar.bar.last_drag([e.screenX, e.screenY]);
        }
        scrollbar.bar.mousemove = function(model, e)
        {
          if(!scrollbar.bar.last_drag())
            return;

          var new_range = scrollbar.range.value() + e.screenY - scrollbar.bar.last_drag()[1];
          var new_value = (new_range - scrollbar.range.min()) / (scrollbar.range.max() - scrollbar.range.min()) * (scrollbar.domain.max() - scrollbar.domain.min()) + scrollbar.domain.min();

          scrollbar.domain.value(Math.max(scrollbar.domain.min(), Math.min(scrollbar.domain.max(), new_value)));
          scrollbar.bar.last_drag([e.screenX, e.screenY]);
        }
        scrollbar.bar.mouseup = function(model, e)
        {
          scrollbar.bar.last_drag(null);
        }

        ko.applyBindings(scrollbar);
      });
    </script>
  </body>
</html>
